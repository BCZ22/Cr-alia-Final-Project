# üöÄ Int√©gration Claude AI - Guide Complet

## üìã Vue d'ensemble

Cette int√©gration fournit une solution compl√®te et professionnelle pour int√©grer l'API Anthropic Claude dans votre SaaS. Elle inclut :

- ‚úÖ **Service backend robuste** avec gestion des erreurs et retry automatique
- ‚úÖ **API routes Next.js** pour le chat et les t√¢ches sp√©cialis√©es
- ‚úÖ **Interface React moderne** avec streaming temps r√©el
- ‚úÖ **Architecture extensible** pour supporter d'autres LLM
- ‚úÖ **Gestion des co√ªts** et optimisation des mod√®les
- ‚úÖ **S√©curit√© renforc√©e** et validation des entr√©es

## üõ†Ô∏è Installation

### 1. D√©pendances

```bash
npm install @anthropic-ai/sdk
```

### 2. Variables d'environnement

Cr√©ez un fichier `.env.local` √† la racine de votre projet :

```env
# Configuration Claude AI
ANTHROPIC_API_KEY=your_anthropic_api_key_here

# Configuration optionnelle
NODE_ENV=development
CLAUDE_MAX_TOKENS=4096
CLAUDE_TIMEOUT=30000
CLAUDE_RETRY_ATTEMPTS=3
CLAUDE_DEFAULT_MODEL=claude-3-5-sonnet-20241022
```

### 3. Cl√© API Anthropic

1. Rendez-vous sur [console.anthropic.com](https://console.anthropic.com)
2. Cr√©ez un compte ou connectez-vous
3. G√©n√©rez une nouvelle cl√© API
4. Copiez la cl√© dans votre fichier `.env.local`

## üèóÔ∏è Architecture

### Structure des fichiers

```
lib/ai/
‚îú‚îÄ‚îÄ claude-service.ts      # Service principal Claude
‚îú‚îÄ‚îÄ claude-adapter.ts      # Adaptateur pour l'interface LLM
‚îú‚îÄ‚îÄ llm-service.ts         # Service unifi√© pour tous les LLM
‚îî‚îÄ‚îÄ index.ts              # Point d'entr√©e et configuration

app/api/
‚îú‚îÄ‚îÄ chat/route.ts         # API route pour le chat
‚îî‚îÄ‚îÄ ai/tasks/route.ts     # API route pour les t√¢ches sp√©cialis√©es

components/ui/ai/
‚îú‚îÄ‚îÄ chat-interface.tsx    # Interface de chat React
‚îî‚îÄ‚îÄ ai-tasks.tsx          # Composant pour les t√¢ches IA

app/ai-claude/
‚îî‚îÄ‚îÄ page.tsx              # Page de d√©monstration
```

### Services principaux

#### 1. ClaudeService (`claude-service.ts`)

Service de base pour interagir avec l'API Claude :

```typescript
import { claudeService } from '@/lib/ai';

// Chat simple
const response = await claudeService.chat({
  messages: [{ role: 'user', content: 'Bonjour !' }],
  model: 'claude-3-5-sonnet-20241022'
});

// Chat avec streaming
for await (const chunk of claudeService.chatStream(request)) {
  console.log(chunk.content);
}

// T√¢ches sp√©cialis√©es
const sentiment = await claudeService.analyzeSentiment('Ce produit est incroyable !');
const summary = await claudeService.summarizeText(longText, 200);
const translation = await claudeService.translateText('Hello', 'French');
```

#### 2. UnifiedLLMService (`llm-service.ts`)

Service unifi√© pour g√©rer plusieurs fournisseurs LLM :

```typescript
import { unifiedLLMService } from '@/lib/ai';

// Enregistrer un nouveau fournisseur
unifiedLLMService.registerProvider(newProvider);

// Utiliser le meilleur fournisseur disponible
const response = await unifiedLLMService.chatWithBestProvider(request);

// Comparer les co√ªts
const costs = unifiedLLMService.compareCosts('claude-3-5-sonnet-20241022');

// Recommandations de mod√®les
const recommendations = unifiedLLMService.recommendModel('analysis', 'medium', 'balanced');
```

#### 3. ClaudeAdapter (`claude-adapter.ts`)

Adaptateur qui impl√©mente l'interface LLMProvider pour Claude :

```typescript
import { claudeAdapter } from '@/lib/ai';

// Utilisation directe
const response = await claudeAdapter.chat(request);

// Estimation des co√ªts
const cost = claudeAdapter.estimateCost('claude-3-5-sonnet-20241022', 1000, 500);
```

## üîå Utilisation

### 1. Chat simple

```typescript
import { claudeService } from '@/lib/ai';

const response = await claudeService.generateContent(
  'Tu es un assistant utile.',
  'Explique-moi la photosynth√®se.',
  'claude-3-5-sonnet-20241022'
);

console.log(response.content);
```

### 2. Chat avec streaming

```typescript
import { claudeService } from '@/lib/ai';

for await (const chunk of claudeService.generateContentStream(
  'Tu es un assistant utile.',
  'Raconte-moi une histoire.',
  'claude-3-5-sonnet-20241022'
)) {
  if (chunk.isComplete) {
    console.log('Histoire compl√®te:', chunk.content);
    console.log('Usage:', chunk.usage);
  } else {
    process.stdout.write(chunk.content);
  }
}
```

### 3. T√¢ches sp√©cialis√©es

```typescript
import { claudeService } from '@/lib/ai';

// Analyse de sentiment
const sentiment = await claudeService.analyzeSentiment(
  'Ce produit est incroyable !',
  'claude-3-5-haiku-20241022'
);

// R√©sum√© de texte
const summary = await claudeService.summarizeText(
  longText,
  200,
  'claude-3-5-haiku-20241022'
);

// Traduction
const translation = await claudeService.translateText(
  'Hello world',
  'French',
  'English',
  'claude-3-5-sonnet-20241022'
);
```

### 4. API Routes

#### Chat API

```typescript
// POST /api/chat
const response = await fetch('/api/chat', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    messages: [{ role: 'user', content: 'Bonjour !' }],
    model: 'claude-3-5-sonnet-20241022',
    stream: true,
    temperature: 0.7,
    maxTokens: 4096
  })
});
```

#### T√¢ches API

```typescript
// POST /api/ai/tasks
const response = await fetch('/api/ai/tasks', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    task: 'sentiment',
    text: 'Ce produit est incroyable !',
    model: 'claude-3-5-haiku-20241022'
  })
});
```

## üé® Composants React

### 1. ChatInterface

Interface de chat compl√®te avec streaming :

```tsx
import { ChatInterface } from '@/components/ui/ai/chat-interface';

<ChatInterface 
  initialSystemPrompt="Tu es un assistant sp√©cialis√© en..."
  className="h-[600px]"
/>
```

### 2. AITasks

Interface pour les t√¢ches sp√©cialis√©es :

```tsx
import { AITasks } from '@/components/ui/ai/ai-tasks';

<AITasks />
```

## üîß Configuration

### Mod√®les disponibles

| Mod√®le | Description | Co√ªt entr√©e | Co√ªt sortie | Contexte |
|--------|-------------|-------------|-------------|----------|
| `claude-3-5-sonnet-20241022` | √âquilibr√© | $3.00/1M | $15.00/1M | 200K |
| `claude-3-5-haiku-20241022` | Rapide | $0.25/1M | $1.25/1M | 200K |
| `claude-3-opus-20240229` | Pr√©cis | $15.00/1M | $75.00/1M | 200K |

### Configuration par d√©faut

```typescript
export const CLAUDE_DEFAULT_CONFIG = {
  maxTokens: 4096,
  temperature: 0.7,
  topP: 1,
  topK: 1,
} as const;
```

### Gestion des erreurs

Le service g√®re automatiquement :

- ‚úÖ **Rate limiting** avec retry automatique
- ‚úÖ **Erreurs r√©seau** avec d√©lai progressif
- ‚úÖ **Erreurs d'authentification** avec messages clairs
- ‚úÖ **Validation des mod√®les** et param√®tres

## üöÄ D√©ploiement

### 1. Production

```bash
# Build de production
npm run build

# D√©marrage
npm start
```

### 2. Variables d'environnement de production

```env
ANTHROPIC_API_KEY=your_production_api_key
NODE_ENV=production
CLAUDE_MAX_TOKENS=8192
CLAUDE_TIMEOUT=60000
```

### 3. Monitoring

```typescript
// Exemple de monitoring des co√ªts
import { claudeAdapter } from '@/lib/ai';

const cost = claudeAdapter.estimateCost(model, inputTokens, outputTokens);
if (cost.totalCost > 0.10) {
  console.warn(`Co√ªt √©lev√©: $${cost.totalCost}`);
}
```

## üîí S√©curit√©

### Bonnes pratiques

1. **Jamais exposer la cl√© API c√¥t√© client**
2. **Valider toutes les entr√©es utilisateur**
3. **Limiter la taille des prompts**
4. **Impl√©menter un syst√®me de rate limiting**
5. **Logger les utilisations pour audit**

### Validation des entr√©es

```typescript
// Validation automatique des mod√®les
if (!claudeService.validateModel(model)) {
  throw new Error('Mod√®le non support√©');
}

// Validation des param√®tres
if (maxTokens > 200000) {
  throw new Error('Nombre de tokens trop √©lev√©');
}
```

## üìä Monitoring et Analytics

### M√©triques disponibles

- **Usage des tokens** (entr√©e/sortie)
- **Co√ªts par requ√™te**
- **Temps de r√©ponse**
- **Taux d'erreur**
- **Mod√®les utilis√©s**

### Exemple de logging

```typescript
// Log des m√©triques
console.log({
  timestamp: new Date().toISOString(),
  model: response.model,
  inputTokens: response.usage.inputTokens,
  outputTokens: response.usage.outputTokens,
  totalCost: estimatedCost.totalCost,
  duration: Date.now() - startTime
});
```

## üîÆ Extensibilit√©

### Ajouter un nouveau LLM

```typescript
import { LLMProvider } from '@/lib/ai';

class OpenAIProvider implements LLMProvider {
  name = 'openai';
  models = ['gpt-4', 'gpt-3.5-turbo'];
  
  async chat(request: LLMRequest): Promise<LLMResponse> {
    // Impl√©mentation OpenAI
  }
  
  // ... autres m√©thodes
}

// Enregistrer le fournisseur
unifiedLLMService.registerProvider(new OpenAIProvider());
```

### Support des nouveaux mod√®les

```typescript
// Ajouter un nouveau mod√®le Claude
export type ClaudeModel = 
  | 'claude-3-5-sonnet-20241022'
  | 'claude-3-5-haiku-20241022'
  | 'claude-3-opus-20240229'
  | 'nouveau-modele-2024'; // Nouveau mod√®le
```

## üß™ Tests

### Tests unitaires

```bash
# Tests des services
npm run test:ai

# Tests d'int√©gration
npm run test:ai:integration
```

### Tests de charge

```bash
# Test de charge sur l'API chat
npm run test:ai:load
```

## üìö Ressources

### Documentation officielle

- [Anthropic API Documentation](https://docs.anthropic.com/)
- [Claude Models](https://docs.anthropic.com/en/docs/models-overview)
- [API Reference](https://docs.anthropic.com/en/api)

### Support

- [Anthropic Community](https://community.anthropic.com/)
- [GitHub Issues](https://github.com/your-repo/issues)

## üéØ Prochaines √©tapes

1. **Int√©grer dans votre dashboard existant**
2. **Ajouter l'authentification utilisateur**
3. **Impl√©menter un syst√®me de quotas**
4. **Ajouter le support d'autres LLM**
5. **Cr√©er des templates de prompts**
6. **Impl√©menter un syst√®me de feedback**

---

## üìù Notes de version

### v1.0.0 (Initial)
- ‚úÖ Int√©gration Claude API compl√®te
- ‚úÖ Chat avec streaming temps r√©el
- ‚úÖ T√¢ches sp√©cialis√©es (sentiment, r√©sum√©, traduction)
- ‚úÖ Architecture extensible pour multi-LLM
- ‚úÖ Interface React moderne et responsive
- ‚úÖ Gestion des erreurs et retry automatique
- ‚úÖ Optimisation des co√ªts et monitoring

---

**üéâ F√©licitations ! Vous avez maintenant une int√©gration Claude AI compl√®te et professionnelle dans votre SaaS !**
